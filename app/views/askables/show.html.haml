
- if current_user
  - @answerable = @askable.answerables.where(country_code: @country.code, user_id: current_user.id).first 

- @answerable ||= @askable.is_a?(Poll) ? Ballot.new(vote: 0) : Answer.new

- content_for :title_string do
  #{ t 'country_title', :country_name => @country.to_s }:
  = @askable.body.truncate(80, :separator => ' ')

- content_for :js do
  = javascript_include_tag 'askable'

- if false  # disable ellipse collapse feature
  :css
    .ellips:after {
      content: "#{ t('askable.show.css.expand')}";
    }

#spbody
  .statuses
    .user.status.active
      = t('askable.show.created', link: user_country_flag_link(@askable.user)).html_safe
    
    - unless @orig_lang == I18n.locale
      .status
        = t('askable.show.original')
        %a.link(href='#{ original_country_askable_path(@country, @askable) }' data-remote=true)
          %span.lang= t("language.code.#{ @orig_lang }").upcase
          %span.text= t("language.#{ @orig_lang }")
  
  #sph
    .flag
      %a(href='#{ country_path(@country) }' title='#{ @country.to_s }')
        = country_image @country, 'l', :size => '60x60'
    .blocks
      = render 'follow'
      .table.share
        .cell
          &#8618;
          = t 'askable.show.share'
          %a(href='#')<
            = image_tag '/assets/twitter.png'
          %a(href='#')
            = image_tag '/assets/facebook.png'
    
      = render 'answer_block'
    
    = render 'question'
        
    .actions
      %span.coverage
        = askable_coverage_info(@askable.coverage, @country)
    
      - if @orig_lang == I18n.locale
        - unless @langs.blank?
          %span.translation(title='#{t("askable.show.is_orig_title")}')
            %span.lang= t("language.code.#{ @orig_lang }").upcase
            = t('askable.show.is_orig')
          
          - if false
            %span.availables
              = image_tag '/assets/translation.png'
              = t('askable.show.available')
              - @langs.each do |l|
                %a(href='#')= t("language.code.#{ l }")
        
      - else
        %span.translation(title='#{ t("askable.show.t_from_to", to: t("language.#{ I18n.locale }"), from: t("language.#{ @orig_lang }"))}')
          %span.lang<
            = t("language.code.#{ @askable.translation.locale }").upcase
          - if @askable.auto_translated.to_i > 0
            = t('askable.show.auto')
          - else
            = t('askable.show.translator')
            = user_avatar_link(User.find(@askable.translation.versions.last.whodunnit), size: '18x18')


      %span.others
        %span.comments
          %a#ltac(href='#' onclick='aac.toggle_comments(); return false;')<
            = image_tag '/assets/comment.png'
            = t 'plural.comment', count: @askable.comment_threads.size
        
        - if can_edit?(@askable)
          %span.edit
            %a(href='#' onclick='aac.toggle_edit_askable(); return false;')<
              = image_tag '/assets/edit.png'
              = t('edit')
      
        - if can_improve?(@askable)
          %span.translate
            = link_to_function t('askable.show.improve'), 'aac.toggle_edit_askable()'

  = render 'askable_comments'
  = render 'answerable'
  
  #spb
    .rc
      - askables = @askable.more_askables
      
      - unless askables.blank?
        %h3 More questions
    
        %ul
          - askables.each do |a|
            %li= link_to a, country_askable_path(@country, a)
      
      - versions = Version.where('item_type = ? AND whodunnit is not null', 'Askable::Translation').where(item_id: @askable.translations.collect {|t| t.id}).group('whodunnit')
      - if versions.present? && versions.size.size > 1
        %h3.page Contributors
        .contrib
          - versions.each do |v|
            = user_small_avatar_link(User.find(v.whodunnit))
        
      
      %h3
        Return to
        = link_to @country.to_s, country_path(@country)

    .lc
      = render "askable_answers"
            
